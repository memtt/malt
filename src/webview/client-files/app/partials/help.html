<h1>Profiling</h1>

<p>To profile with MALT you juste have to use the wrapper script <code>malt</code> in front of your program :</p>

<pre>malt my_program --option=A</pre>

<p>It will automatically generate files in current directory :</p>
<ul>
	<li><i>malt-my_program-12589.json</i> : contain the main data generated by MALT profiling.</li>
	<li><i>malt-my_program-12589.ini</i> : dump of the configuration used by MALT.</li>
</ul>

<h1>Use of the GUI</h1>

<p>To launch this GUI, you just have to use the <code>malt-webview</code> command :</p>

<pre>malt-webview -i malt-my_program-12589.json [-p PORT]</pre>

<p>It opens a webserver on port 8080 by default so you can open it with your browser by going to <a href='http://localhost:8080'>http://localhost:8080</a>.
If you run it remotely, you might need to forward the port through SSH by using command : </p>

<pre>ssh user@foo -L8080:localhost:8080 </pre>

<h1>Recommanded options to compile your code</h1>

MALT work out of the box with your program but it required you to compile your program with 
debug options (<i>-g</i>) to get access to the source code attached to each call sites.

It might also be better to use <i>-O0</i> or use <i>-fno-inline</i> to disable inlining which might
provide more accurate call stacks to you.

<h1>Definition</h1>

<p>MALT use several metrics about memory which are defined here with small examples to get a better understand their meanings.</p>

<h2>Requested memory</h2>

<p>This is the memory the user has request through standard functions <code>malloc</code>, <code>calloc</code>, <code>realloc</code> and derived ones. We can illustrate
evolution of this metric with the given code :</p>

<pre>
void * a = malloc(16);    //Total requested = 16
void * b = malloc(16);    //Total requested = 32
free(b);                  //Total requested = 16
b = malloc(16);           //Total requested = 32
free(b);                  //Total requested = 16
a = realloc(a,64);        //Total requested = 64
free(a);                  //Total requested = 0
</pre>

<h2>Virtual memory</h2>

<p>This is the memory the memory allocator (<code>malloc</code>) has requested to the system. Here, we remind that memory management is done at page (4K segments) granularity
by the OS. When you request an allocation of 16 bytes, the allocator must request a least 4Kb to the OS through the <code>mmap</code> system call.
We can illustrate with the given code :</p>

<pre>
                          //initial virtual = 0
void * a = malloc(16);    //Total virtual = 4K
void * b = malloc(16);    //Total virtual = 4K
free(b);                  //Total virtual = 4K
b = malloc(16K);          //Total virtual = 20K
free(b);                  //Total virtual = 20k
a = realloc(a,64);        //Total virtual = 20K
free(a);                  //Total virtual = 0
</pre>

<p>There is no guaranty that the allocator return the virtual memory immediately, it might keep it for latter use. In practice it happens only for small segments (upper magnitude is roughly 128 Kb).
The virtual memory also contain all the libraries and executable code so can contain much more than the requested memory.</p>

<p>Caution, in practice the virtual take in account the memory space consumed by the binaries (lib and executable) of your program. MALT removes its own memory usage from this metric.</p>

<h2>Physical memory</h2>

<p>By default the operating system only allocate Virtual Memory by keeping track of the authorized memory addressed. He didn't associate any physical
pages to those virtual segments. The first access on a virtual page generates a "page fault" to notify the OS. On page fault, the OS search and
map a physical page to the virtual one. The virtual memory give the memory requested by the user and the physical give the memory used by
the user. Gaps between those two metrics point too large allocation compared to the memory usage.</p>

<pre>
                          //initial virtual = 0,  physical = 0
void * a = malloc(2M);    //Total virtual = 2M,  physical = 0
memset(a,0,1M)            //Total virtual = 2M,  physical = 1M
memset(a+1M,0,1M)         //Total virtual = 2M,  physical = 2M
free(a);                  //Total virtual = 0,   physical = 0
</pre>

<p>Caution, in practice the physical memory, like the virtual memory, takes into account the memory space consumed by the binaries (lib and executable) of your program. MALT removes its own memory usage from this metric.</p>

<h2>Internal memory</h2>

<p>The internal memory represent the memory used by MALT itself. It is determined by using a custom allocator for MALT allocations separately from the ones of you program which are managed by the standard allocator.</p>

<h2>About memory peaks</h2>

<p>MALT provide two kinds of memory peaks : </p>

<ul>
	<li>Local peak : it tracks the maximum memory used by a given function for the whole execution.</li>
	<li>Global peak : it tracks the memory used by a function at global peak time, it might be smaller than local peak as the function might use no memory when the global peak append.</li>
</ul>

<h2>About chunk lifetime</h2>

<p>Chunk lifetime corresponds to the time between <code>malloc</code> and <code>free</code>. Ideally, it needs to be as long as possible, as short lifetime linked to lot of allocation can lead to performance issues.</p>

<!--<h2>About fragmentation</h2>-->

<h2>Allocation rates</h2>

<p>Allocation rate are related to number of allocation in a short period. It can pinpoint performance overhead due to operating system memory management functions.</p>

<h2>About counters</h2>

<p>For each counter, MALT tracks two sub-metric:</p>

<ul>
    <li>Inclusive: It is the number of times <code>malloc</code> (<code>realloc</code>, <code>free</code>, ...) has been seen under this function (by looking in all call stacks and accounting if called in child functions). This is also called <code>total</code> in code. </li>
    <li>Exclusive: It is the number of times exactly that <code>malloc</code> (<code>realloc</code>, <code>free</code>, ...) has been called in this function. This is also called <code>own</code> in code. </li>
</ul>

By default, values displayed are inclusives, i.e. it account for every allocation below it,as on the home page.
Exclusives value are only displayed if it is relevant to the function.

<h1>Thanks</h1>

<!--<h2>Original project finance plan</h2>

<p>Special thanks to <a href='http://www.exascale-computing.eu/'>Exascale Computing Research Lab</a> and <a href='http://www.uvsq.fr/'>Versailles university (UVSQ)</a> for the original finance plan to develop this project. The project was developped in the <a href='http://www.maqao.org/'>MAQAO</a> team thanks to them.</p>
<a href='http://www.exascale-computing.eu/'><img src="http://www.exascale-computing.eu/wp-content/themes/exascale/gfx/logos/exateclab.gif"/></a>
<a href='http://www.uvsq.fr/'><img src='http://www.uvsq.fr/uas/ksup/LOGO/logo-site-uvsq.png'></a>
<a href='http://www.maqao.org/'><img src='http://www.maqao.org/templates/joomlage0053-maximum/images/logo.png'></a>-->

<h2>Thanks to web dependencies</h2>

<p>Special thanks to external projects used to build the MALT GUI : <a href="http://getbootstrap.com/">bootstrap</a>, <a href='https://angularjs.org/'>AngularJS</a>, <a href='http://nodejs.org/'>NodeJS</a> and <a href='http://d3js.org/'>D3js</a></p>

<a href="http://getbootstrap.com/"><img src="http://getbootstrap.com/apple-touch-icon.png" height="80px" style="margin:20px"/></a>
<a href='https://angularjs.org/'><img src="https://angularjs.org/img/AngularJS-large.png" height="80px" style="margin:20px"/></a>
<a href='http://nodejs.org/'><img src="http://nodeblog.files.wordpress.com/2011/07/nodejs.png" height="80px" style="margin:20px"/></a>
<a href='http://d3js.org/'><img src="https://blog.logentries.com/wp-content/uploads/2014/08/D3.js-Logo.png" height="80px" style="margin:20px"/></a>

<h2>Developers</h2>

<p>MALT is currently developed by SÃ©bastien Valat.</p>